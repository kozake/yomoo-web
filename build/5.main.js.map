{"version":3,"sources":["../../src/pages/reading-log/reading-log.module.ts","../../src/pages/reading-log/reading-log.ts"],"names":[],"mappings":"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","file":"5.main.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ReadingLogPage } from './reading-log';\n\n@NgModule({\n  declarations: [\n    ReadingLogPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ReadingLogPage),\n  ],\n  exports: [\n    ReadingLogPage\n  ]\n})\nexport class ReadingLogPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/reading-log/reading-log.module.ts","import { Component } from '@angular/core';\nimport { DatePipe } from '@angular/common';\nimport { IonicPage, NavController, NavParams, AlertController } from 'ionic-angular';\nimport { AppReadingBook, AppReadingLog } from '../../models';\nimport { AppReadingBookProvider, AppLoadingProvider } from '../../providers';\nimport { DateUtils } from '../../utils';\n\n@IonicPage({\n  name: 'ReadingLogPage',\n  segment: 'reading-log'\n})\n@Component({\n  selector: 'reading-log',\n  templateUrl: 'reading-log.html'\n})\nexport class ReadingLogPage {\n\n  book: AppReadingBook;\n  callback: (book: AppReadingBook, cancelled: boolean) => {};\n\n  startDate: string;\n  startTime: string;\n  endTime: string;\n\n  pages;\n\n  constructor(\n    private params: NavParams,\n    private navCtrl: NavController,\n    public alertCtrl: AlertController,\n    private appReadingBookProvider: AppReadingBookProvider,\n    private loading: AppLoadingProvider,\n    private datePipe: DatePipe\n  ) {\n    this.book = params.data.book;\n    this.callback = params.data.callback;\n    // let datePipe = new DatePipe('en-US');\n\n    let endDatetime = new Date();\n    this.startDate = params.data.startDate;\n    this.startTime = params.data.startTime;\n    this.endTime = datePipe.transform(endDatetime, 'HH:mm:ss');\n\n    this.pages = [{start: params.data.startPage, end: params.data.startPage}];\n\n  }\n\n  addPage(event) {\n    this.pages.push({start:0, end: 0});\n  }\n\n  deletePage(event) {\n    this.pages.pop()\n  }\n\n  doAdd(event) {\n\n    let startDt = new Date(this.startDate + 'T' + this.startTime + DateUtils.getTimezoneOffsetStr());\n    let endDt = new Date(this.startDate + 'T' + this.endTime + DateUtils.getTimezoneOffsetStr());\n    if (startDt.getTime() > endDt.getTime()) {\n      endDt.setDate(endDt.getDate() + 1);\n    }\n\n    this.book.appReadingLogs = this.book.appReadingLogs || new Array<AppReadingLog>();\n    this.pages.forEach(page => {\n      this.book.appReadingLogs.push(new AppReadingLog({\n        startDate: startDt,\n        endDate: endDt,\n        startPage: page.start,\n        endPage: page.end\n      }));\n    });\n\n    if (this.book.readingStatus == AppReadingBook.ReadingStatusEnum.UNREAD) {\n      this.book.readingStatus = AppReadingBook.ReadingStatusEnum.READING;\n    }\n\n    if (this.book.readingStatus == AppReadingBook.ReadingStatusEnum.READING\n     && this.book.getReadPages() >= this.book.pages) {\n\n      let confirm = this.alertCtrl.create({\n        title: '読了',\n        message: '全てのページを読みました。読了としますか？',\n        buttons: [\n          {\n            text: 'はい',\n            handler: () => {\n              this.book.readingStatus = AppReadingBook.ReadingStatusEnum.FINISHED;\n              this.updateBook();\n            }\n          },\n          {\n            text: 'いいえ',\n            handler: () => {\n              this.updateBook();\n            }\n          }\n        ]\n      });\n      confirm.present();\n    } else {\n      this.updateBook();\n    }\n  }\n\n  private updateBook() {\n\n    this.loading.start(() => {\n\n      return this.appReadingBookProvider.update(this.book).toPromise();\n\n    }).then((book: AppReadingBook) => {\n      this.callback(book, false);\n      this.navCtrl.pop();\n    }).catch(() => {\n      let alert = this.alertCtrl.create({\n        title: 'エラー',\n        subTitle: '保存に失敗しました。',\n        buttons: ['OK']\n      });\n      alert.present();\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/reading-log/reading-log.ts"],"sourceRoot":""}