{"version":3,"sources":["../../src/pages/reading-book/reading-book.module.ts","../../src/pages/reading-book/reading-book.ts"],"names":[],"mappings":"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","file":"6.main.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { ReadingBookPage } from './reading-book';\n\n@NgModule({\n  declarations: [\n    ReadingBookPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(ReadingBookPage),\n  ],\n  exports: [\n    ReadingBookPage\n  ]\n})\nexport class ReadingBookPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/reading-book/reading-book.module.ts","import { Component, Optional } from '@angular/core';\nimport { DatePipe } from '@angular/common';\nimport { IonicPage, NavController, NavParams, AlertController } from 'ionic-angular';\nimport { Observable } from 'rxjs/Observable';\nimport { Subscription } from 'rxjs/Subscription';\nimport { AppReadingBook } from '../../models';\nimport { AppLoadingProvider } from '../../providers';\nimport { TwitterConnect } from '@ionic-native/twitter-connect';\nimport { DateUtils } from '../../utils';\n\n@IonicPage({\n  name: 'ReadingBookPage',\n  segment: 'reading-book'\n})\n@Component({\n  selector: 'reading-book',\n  templateUrl: 'reading-book.html'\n})\nexport class ReadingBookPage {\n\n  book: AppReadingBook;\n  callback: (book: AppReadingBook) => {};\n\n  startDate: string;\n  startTime: string;\n  startPage: number;\n\n  timerString: string;\n\n  isNeedCheckCanLeave = true;\n  \n  constructor(\n    private params: NavParams,\n    private navCtrl: NavController,\n    private alertCtrl: AlertController,\n    private loading: AppLoadingProvider,\n    private datePipe: DatePipe,\n    @Optional() private twitter: TwitterConnect\n  ) {\n    this.book = params.data.book;\n    this.callback = params.data.callback;\n  }\n\n  timer: Observable<number>;\n  subscription: Subscription;\n\n  ionViewDidLoad() {\n    this.setInitData();\n    this.timer = Observable.timer(0,500);\n    this.subscription = this.timer.subscribe(t => {\n      if (this.isReading()) {\n        this.timerString = this.getTimerString();\n      } else {\n        let date = new Date();\n        this.startTime = this.datePipe.transform(date, 'HH:mm:ss');\n      }\n    });\n  }\n\n  ionViewDidEnter() {\n    this.isNeedCheckCanLeave = true;\n  }\n\n  ionViewCanLeave() {\n    return new Promise(resolve => {\n\n      if (!this.isNeedCheckCanLeave) {\n        resolve(true);\n        \n      } else if (this.isReading()) {\n        let confirm = this.alertCtrl.create({\n          title: '戻る',\n          message: '読書を中断して一覧画面に戻ります。よろしいですか？',\n          buttons: [\n            {\n              text: 'はい',\n              handler: () => {\n                this.callback(this.book);\n                this.stopReading();\n                resolve(true);\n              }\n            },\n            {\n              text: 'いいえ',\n              handler: () => {\n                resolve(false);\n              }\n            }\n          ]\n        });\n        confirm.present();\n      } else {\n        this.callback(this.book);\n        resolve(true);\n      }\n    });\n  }\n\n  private _isReading = false;\n  isReading(): boolean {\n    return this._isReading;\n  }\n\n  startReading() {\n    this._isReading = true;\n  }\n\n  stopReading() {\n    this._isReading = false;\n    this.timerString = null;\n  }\n\n  doStartReading(event: any) {\n    this.startReading();\n  }\n\n  doStopReading(event: any) {\n    this.isNeedCheckCanLeave = false;\n    this.navCtrl.push('ReadingLogPage', {\n      startDate: this.startDate,\n      startTime: this.startTime,\n      startPage: this.startPage,\n      book: this.book,\n      callback: (book, cancelled) => {\n        if (!cancelled) {\n          this.book = book\n          this.setInitData();\n          this.stopReading();\n        }\n      }\n    });\n  }\n\n  chart(event: Event) {\n\n    this.isNeedCheckCanLeave = false;\n    this.navCtrl.push('ReadingChartPage', this.book);\n  }\n\n  tweetReading(event: Event) {\n\n    this.isNeedCheckCanLeave = false;\n    this.navCtrl.push('TweetReadingPage', this.book);\n  }\n\n  private getTimerString(): string {\n    console.log(this.startTime);\n    let startDatetime = new Date(this.startDate + 'T' + this.startTime + DateUtils.getTimezoneOffsetStr());\n    let time = new Date().getTime() - startDatetime.getTime();\n\n    let h = Math.floor(time / (60 * 60 * 1000));\n    let m = Math.floor((time % (60 * 60 * 1000)) / (60 * 1000));\n    let s = Math.floor((time % (60 * 1000)) / 1000);\n\n    let hh = ('0' + h).slice(-2);\n    let mm = ('0' + m).slice(-2);\n    let ss = ('0' + s).slice(-2);\n\n    return hh + ':' + mm + ':' + ss;\n  }\n\n  private setInitData() {\n\n    let date = new Date();\n    this.startDate = this.datePipe.transform(date, 'y-MM-dd');\n    this.startTime = this.datePipe.transform(date, 'HH:mm:ss');\n\n    let lastReadingLog = this.book.getLastReadingLog();\n    this.startPage = lastReadingLog != null ? lastReadingLog.endPage : 1;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/reading-book/reading-book.ts"],"sourceRoot":""}